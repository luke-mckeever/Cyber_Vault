# [DRAFT] Malware Analysis Framework


```
If file is an Executable:
├── If Linux Executable:
│   ├── Perform ELF Header Analysis
│   ├── Check for Packers/Obfuscation (e.g., UPX)
│   ├── Use `strings`, `readelf`, `objdump`, `ltrace`, `strace`
│   └── Dynamic analysis in isolated Linux VM or sandbox
├── If Windows Executable:
│   ├── Identify PE Header with PEview or Detect It Easy
│   ├── Check for Packers (PEiD, DIE)
│   ├── If coded in C:
│   │   ├── Perform static disassembly (Ghidra/IDA)
│   │   ├── Look for common API calls (e.g., CreateProcess, WriteFile)
│   │   └── Dynamic analysis in FLAREVM/Cuckoo
│   ├── If coded in .NET:
│   │   ├── Use dnSpy/ILSpy for decompilation
│   │   ├── Analyze assemblies and embedded resources
│   │   └── Check for PowerShell or other script injectors
│   ├── If coded in Python (PyInstaller, Py2exe):
│   │   ├── Extract .pyc or .pyo using tools like pyinstxtractor
│   │   ├── Decompile with uncompyle6
│   │   └── Look for dropped scripts or embedded binaries
│   └── Perform behavioral analysis with Process Monitor, API Monitor

If file is a Script:
├── If VBS Script:
│   ├── Open in safe viewer (e.g., Notepad++, ViperMonkey)
│   ├── Look for obfuscation (e.g., chr(), base64)
│   ├── Extract and analyze embedded commands
│   └── Sandbox execution with monitoring tools
├── If PowerShell Script:
│   ├── Beautify and deobfuscate code (Invoke-Obfuscation analysis)
│   ├── Search for encoded commands or IEX
│   ├── Analyze for web calls, file writes, registry edits
│   └── Dynamic execution in safe Windows VM with logging
├── If JavaScript:
│   ├── Use jsbeautifier to deobfuscate
│   ├── Look for eval(), document.write(), ActiveXObject
│   └── Analyze in browser sandbox (e.g., Malzilla)
├── If Batch File:
│   ├── Analyze command logic and redirections
│   ├── Check for payload droppers or downloader logic
│   └── Execute in isolated environment to capture IOCs

If file is a Document:
├── If Microsoft Office (doc, xls, ppt):
│   ├── Scan with olevba/oletools
│   ├── Look for macros, embedded objects, DDE
│   └── Open in safe VM with Office logging enabled
├── If PDF:
│   ├── Use pdfid.py and pdf-parser.py to inspect
│   ├── Search for JavaScript and suspicious actions
│   └── Render in sandboxed PDF reader
├── If RTF:
│   ├── Use RTFScan
│   ├── Look for OLE objects and shellcode
│   └── Extract payloads for further analysis

If file is an Archive:
├── Extract safely (7zip, zipdump)
├── Scan contents individually through the tree
└── Check for password-protected content or nested archives

If file is a Shortcut (LNK):
├── Inspect with LECmd or lnk-parser
├── Look for hidden paths and remote payload URLs
└── Extract embedded shellcode or script paths

If file is a Macro or Embedded Script:
├── Use olevba, mraptor, oledump
├── Check for base64, hex, GZIP or ROT encodings
└── Analyze macro execution chains
```
